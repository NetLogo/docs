<!DOCTYPE html>
<title>
      NetLogo 7.0.0-beta2 User Manual: Sr Extension
    </title>
    <link rel="stylesheet" href="netlogo.css" type="text/css">
    <style type="text/css">
p { margin-left: 1.5em ; }
    h3 { font-size: 115% ; }
    h4 { font-size: 100% ; margin-left: 1.5em ; background: white ; }
    </style>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<h1>NetLogo Sr Extension</h1>
<h2><a href="#citing-simple-r-in-research" id="citing-simple-r-in-research" class="section-anchor">Citing Simple R in Research</a></h2>
<p>If you use the Simple R extension in research, we ask that you cite us,</p>
<p>Hovet, J. Head, B. &amp; Wilensky, U. (2022). “Simple R NetLogo extension”. <a href="https://github.com/NetLogo/SimpleR-Extension" target="_blank">https://github.com/NetLogo/SimpleR-Extension</a> Evanston, IL: Center for Connected Learning and Computer Based Modeling, Northwestern University.</p>
<h2>Primitives</h2>
<div id="">
  <a href="#sr:setup"><code>sr:setup</code></a>
  <a href="#sr:run"><code>sr:run</code></a>
  <a href="#sr:runresult"><code>sr:runresult</code></a>
  <a href="#sr:set"><code>sr:set</code></a>
  <a href="#sr:set-agent"><code>sr:set-agent</code></a>
  <a href="#sr:set-agent-data-frame"><code>sr:set-agent-data-frame</code></a>
  <a href="#sr:set-data-frame"><code>sr:set-data-frame</code></a>
  <a href="#sr:set-list"><code>sr:set-list</code></a>
  <a href="#sr:set-named-list"><code>sr:set-named-list</code></a>
  <a href="#sr:set-plot-device"><code>sr:set-plot-device</code></a>
</div>
<div class="dict_entry" id="sr:setup">
  <h3><a>sr:setup</a></h3>
  <h4>
    <span class="prim_example">sr:setup</span>
  </h4>
<p>Create the R session that this extension will use to execute code.
This command <em>must</em> be run before running any other R extension primitive.
Running this command again will shutdown the current R environment and start a new one.</p>
</div>
<div class="dict_entry" id="sr:run">
  <h3><a>sr:run</a></h3>
  <h4>
    <span class="prim_example">sr:run <i>R-statement</i></span>
    <span class="prim_example">sr:run <i>R-statement</i> <i>anything...</i></span>
  </h4>
<p>Runs the given R statements in the current session.
To make multi-line R code easier to run, this command will take multiple strings, each of which will be interpreted as a separate line of R code.
For instance:</p>
<pre><code class="language-NetLogo">(sr:run
  &quot;domain &lt;- seq(-3.14, 3.14, 0.01)&quot;
  &quot;range &lt;- sin(domain)&quot;
  &quot;png('my_file.png')&quot;
  &quot;plot(domain, range, &quot;
  &quot;     pch = 20,&quot;
  &quot;     main = 'y = sin(x)',&quot;
  &quot;     xlab = 'x',&quot;
  &quot;     ylab = 'y')&quot;
  &quot;dev.off()&quot;
)
</code></pre>
<p><code>sr:run</code> will wait for the statements to finish before continuing.
If you have long-running R code, NetLogo may freeze for a bit while it runs.</p>
</div>
<div class="dict_entry" id="sr:runresult">
  <h3><a>sr:runresult</a></h3>
  <h4>
    <span class="prim_example">sr:runresult <i>R-expression</i></span>
  </h4>
<p>Evaluates the given R expression and reports the result.
<code>rs:runresult</code> attempts to convert from R data types to NetLogo data types.</p>
<p>Numbers, strings, and booleans convert as you would expect, except for outliers like Infinity and NaN which will be converted into the strings &lsquo;Inf&rsquo; and &lsquo;NaN&rsquo;, respectively.</p>
<p>R vectors and R lists will be converted to NetLogo lists. NA values will be converted into the string &lsquo;NA&rsquo;.</p>
<p>R matrices will be flattened into one-dimensional lists using column-major order.
If you want to convert a matrix into a list of lists before sending it to NetLogo, use the R <code>asplit</code> command.
To convert into a list of column lists, use <code>asplit(&lt;matrix&gt;, 1)</code>; for a list of row lists, use <code>asplit(&lt;matrix&gt;, 2)</code>.</p>
<p>An R DataFrame will be converted into a list of lists, where the first item in each sublist is the name of the column and the second item is a list containing all that row data.
For example, the first 6 rows of the <code>iris</code> dataset will be converted into NetLogo like so:</p>
<pre><code class="language-NetLogo">[
  [&quot;Sepal.Length&quot; [5.1 4.9 4.7 4.6 5 5.4]]
  [&quot;Sepal.Width&quot; [3.5 3 3.2 3.1 3.6 3.9]]
  [&quot;Petal.Length&quot; [1.4 1.4 1.3 1.5 1.4 1.7]]
  [&quot;Petal.Width&quot; [0.2 0.2 0.2 0.2 0.2 0.4]]
  [&quot;Species&quot; [&quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot; &quot;setosa&quot;]]
]
</code></pre>
<p>Other objects will be converted to a string representation if possible and and may throw an error if not.</p>
</div>
<div class="dict_entry" id="sr:set">
  <h3><a>sr:set</a></h3>
  <h4>
    <span class="prim_example">sr:set <i>variable-name</i> <i>value</i></span>
  </h4>
<p>Sets a variable in the R session with the given name to the given NetLogo value.
NetLogo objects will be converted to R objects as expected.</p>
<p>Note that lists in NetLogo are converted into lists in R if the elements are of different types.  If all the elements of a NetLogo list are of the identical number, boolean, or string type then the data will be automatically converted into a vector in R.</p>
<pre><code class="language-NetLogo">sr:set &quot;x&quot; 42
sr:run &quot;print(x)&quot; ;; prints `[1] 42` to the command center
sr:set &quot;y&quot; [1 2 3]
sr:run &quot;print(typeof(y))&quot; ;; prints `[1] &quot;double&quot;` to the command center
sr:run &quot;print(typeof(list(y)))&quot; ;; prints `[1] &quot;list&quot;` to the command center
sr:run &quot;print(y)&quot; ;; prints `[1] 1 2 3` to the command center
show sr:runresult &quot;y&quot; ;; reports [1 2 3]
</code></pre>
<p>Agents are converted into lists with named elements for each agent variable.</p>
<p>Agentsets are converted into a list of the above lists. If you want to convert agents to a data frame, see <code>sr:set-agent-data-frame</code>.  If you want to use <code>sr:set</code> and do the conversion manually, try the following:</p>
<pre><code class="language-R">my_data_frame &lt;- as.data.frame(do.call(rbind, &lt;agentset-list-of-lists&gt;))
</code></pre>
<p>For example:</p>
<pre><code class="language-NetLogo">breed [goats goat]
goats-own [energy ]
create-goats 2 [ set color 75 ]
ask goat 0 [ set energy 42 set xcor 5]
ask goat 1 [ set energy -42 set xcor -5]

sr:set &quot;goat&quot; goat 0
sr:run &quot;print(typeof(goat))&quot; ;; prints `[1] &quot;list&quot;` to the command center
sr:run &quot;print(goat)&quot;
;; Should output:
;; $WHO
;; [1] 0
;;
;; $COLOR
;; [1] 75
;; (etc.)

sr:set &quot;goats_list_of_lists&quot; goats
sr:run &quot;goats_data_frame &lt;- as.data.frame(do.call(rbind, goats_list_of_lists))&quot;
sr:run &quot;print(goats_data_frame)&quot;
;; Should output:
;;   WHO COLOR HEADING XCOR YCOR   SHAPE LABEL LABEL-COLOR BREED HIDDEN? SIZE
;; 1   0    75      82    5    0 default               9.9 GOATS   FALSE    1
;; 2   1    75     200   -5    0 default               9.9 GOATS   FALSE    1
;;   PEN-SIZE PEN-MODE ENERGY
;; 1        1       up     42
;; 2        1       up    -42
;;
</code></pre>
<p>Agents with variables containing references to agentsets will have those variables converted into the string representation of that agentset.</p>
</div>
<div class="dict_entry" id="sr:set-agent">
  <h3><a>sr:set-agent</a></h3>
  <h4>
    <span class="prim_example">sr:set-agent <i>r-variable-name</i> <i>agent or agentset</i> <i>agent-variable-name</i></span>
    <span class="prim_example">sr:set-agent <i>r-variable-name</i> <i>agent or agentset</i> <i>agent-variable-name1</i> <i>agent-variable-name2...</i></span>
  </h4>
<p>Creates a new named list in R with the given variable name.  If you want multiple agent variables make sure to surround the command in parenthesis.</p>
<pre><code>clear-all
sr:setup
create-turtles 2
ask turtle 0 [ set color red set xcor 5]
ask turtle 1 [ set color blue set xcor -5]
(sr:set-agent &quot;t0&quot; turtle 0 &quot;who&quot; &quot;color&quot; &quot;xcor&quot; &quot;hidden?&quot;)
sr:run &quot;print(typeof(t0))&quot;
;; [1] &quot;list&quot;
sr:run &quot;print(t0)&quot;
;; $who
;; [1] 0
;;
;; $color
;; [1] 15
;;
;; $xcor
;; [1] 5
;;
;; $`hidden?`
;; [1] FALSE
</code></pre>
</div>
<div class="dict_entry" id="sr:set-agent-data-frame">
  <h3><a>sr:set-agent-data-frame</a></h3>
  <h4>
    <span class="prim_example">sr:set-agent-data-frame <i>r-variable-name</i> <i>agents</i> <i>agent-variable-name</i></span>
    <span class="prim_example">sr:set-agent-data-frame <i>r-variable-name</i> <i>agents</i> <i>agent-variable-name1</i> <i>agent-variable-name2...</i></span>
  </h4>
<p>Creates a new data frame in R with the given variable name.  The columns will have the names of the NetLogo agent variables used and each row will be one agent&rsquo;s data.  If you want multiple agent variables make sure to surround the command in parenthesis.</p>
<pre><code>clear-all
sr:setup
create-turtles 2
ask turtle 0 [ set color red set xcor 5]
ask turtle 1 [ set color blue set xcor -5]
(sr:set-agent-data-frame &quot;turtles_data_frame&quot; turtles &quot;who&quot; &quot;color&quot; &quot;xcor&quot; &quot;hidden?&quot;)
sr:run &quot;print(typeof(turtles_data_frame))&quot;
;; [1] &quot;list&quot;
sr:run &quot;print(is.data.frame(turtles_data_frame))&quot;
;; [1] TRUE
sr:run &quot;print(turtles_data_frame)&quot;
;;   who color xcor hidden?
;; 1   0    15    5   FALSE
;; 2   1   105   -5   FALSE
</code></pre>
</div>
<div class="dict_entry" id="sr:set-data-frame">
  <h3><a>sr:set-data-frame</a></h3>
  <h4>
    <span class="prim_example">sr:set-data-frame <i>r-variable-name</i> <i>column-name</i> <i>list or anything</i></span>
    <span class="prim_example">sr:set-data-frame <i>variable-name</i> <i>column-name1</i> <i>list or anything 1</i> <i>column-name2</i> <i>list or anything 2...</i></span>
  </h4>
<p>Creates a new data frame in R with the given variable name.  The columns will have the names given.  If the value for a column is a list, those will be the values for that column.  If the value is a non-list, it will be used as the single item in that column.  You can add additional column names and values by surrounding the command in parenthesis.</p>
<pre><code>clear-all
sr:setup
let l1 [10 20 30 40]
let l2 [false true false false]
let l3 [&quot;orange&quot; &quot;green&quot; &quot;blue&quot; &quot;purple&quot;]
(sr:set-data-frame &quot;df1&quot; &quot;score&quot; l1 &quot;enabled&quot; l2 &quot;color&quot; l3)
sr:run &quot;print(typeof(df1))&quot;
;; [1] &quot;list&quot;
sr:run &quot;print(is.data.frame(df1))&quot;
;; [1] TRUE
sr:run &quot;print(df1)&quot;
;;   score enabled  color
;; 1    10   FALSE orange
;; 2    20    TRUE  green
;; 3    30   FALSE   blue
;; 4    40   FALSE purple
</code></pre>
</div>
<div class="dict_entry" id="sr:set-list">
  <h3><a>sr:set-list</a></h3>
  <h4>
    <span class="prim_example">sr:set-list <i>r-variable-name</i> <i>anything</i></span>
    <span class="prim_example">sr:set-list <i>r-variable-name</i> <i>anything1</i> <i>anything2...</i></span>
  </h4>
<p>Creates a new list in R with the given variable name.  You can add additional values by surrounding the command in parenthesis.</p>
</div>
<div class="dict_entry" id="sr:set-named-list">
  <h3><a>sr:set-named-list</a></h3>
  <h4>
    <span class="prim_example">sr:set-named-list <i>r-variable-name</i> <i>column-name</i> <i>list or anything</i></span>
    <span class="prim_example">sr:set-named-list <i>r-variable-name</i> <i>column-name1</i> <i>list or anything 1</i> <i>column-name2</i> <i>list or anything 2...</i></span>
  </h4>
<p>Creates a new named list in R with the given variable name.  The columns will have the names given.  If the value for a column is a list, those will be the values for that column.  If the value is a non-list, it will be used as the single item in that column.  You can add additional column names and values by surrounding the command in parenthesis.</p>
</div>
<div class="dict_entry" id="sr:set-plot-device">
  <h3><a>sr:set-plot-device</a></h3>
  <h4>
    <span class="prim_example">sr:set-plot-device</span>
  </h4>
<p>Activates the visual plot device for R, popping open a window if one is not already open.</p>
</div>
